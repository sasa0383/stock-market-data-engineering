# Database

This component provides the database infrastructure for the stock market data engineering project, including PostgreSQL for relational data storage and Elasticsearch for search and analytics.

## Features

- PostgreSQL database for structured stock market data
- Elasticsearch for fast search and analytics
- Automatic schema initialization
- Data persistence through Docker volumes
- Health checks for service reliability

## Configuration

The database setup is defined in `docker-compose.yml` and includes:
- PostgreSQL 14 with custom initialization script
- Elasticsearch 7.17.0 with single-node discovery

## Components

- **docker-compose.yml**: Docker Compose configuration for database services
- **init.sql**: SQL initialization script for PostgreSQL schema

## Database Schema

The PostgreSQL database includes the following tables:
- `stock_prices`: Raw stock price data
- `trading_signals`: Trading signals generated by the trading bot
- `stock_daily_aggregates`: Daily aggregated stock data
- `stock_weekly_aggregates`: Weekly aggregated stock data
- `stock_monthly_aggregates`: Monthly aggregated stock data
- `stock_moving_averages`: Moving averages for technical analysis
- `users`: User authentication (future use)
- `user_preferences`: User preferences (future use)

## Running Locally

Start the database services:
```
cd database
docker-compose up -d
```

## Accessing the Databases

### PostgreSQL

Connect to PostgreSQL:
```
docker exec -it postgres_db psql -U postgres -d stock_data
```

### Elasticsearch

Access Elasticsearch API:
```
curl http://localhost:9200
```

## Data Persistence

Data is persisted through Docker volumes:
- `postgres_data`: PostgreSQL data
- `elasticsearch_data`: Elasticsearch data

These volumes ensure that data is preserved across container restarts.

## Integration with Other Services

The database services are used by:
- `consumer-data-storage`: Writes data to PostgreSQL
- `consumer-batch-processing`: Reads and writes aggregated data
- `consumer-dashboard`: Reads data for visualization
- `consumer-trading-bot`: Reads historical data for analysis
