# Database Setup

## Overview
The Database component provides persistent storage for stock market data and analytics. It includes PostgreSQL for relational data storage, Elasticsearch for search and analytics, and Kibana for visualization.

## Features
- PostgreSQL database with TimescaleDB extension for time-series data
- Comprehensive schema for stock prices, metrics, and aggregations
- Elasticsearch for full-text search and analytics
- Kibana for data visualization and exploration
- Persistent volume storage for data durability
- User roles and permissions for security

## Components
1. **PostgreSQL**: Relational database for structured data storage
2. **TimescaleDB**: Extension for efficient time-series data handling
3. **Elasticsearch**: Search and analytics engine
4. **Kibana**: Visualization platform for Elasticsearch data

## Database Schema
The PostgreSQL database includes the following tables:
- `stock_prices`: Raw stock price data with timestamps
- `stock_metrics`: Real-time metrics from stream processing
- `stock_daily_aggregates`: Daily price aggregations
- `stock_weekly_aggregates`: Weekly price aggregations
- `stock_monthly_aggregates`: Monthly price aggregations
- `trading_signals`: Signals generated by trading strategies
- `symbols`: Metadata about tracked stock symbols

## Usage
1. Start the database services:
   ```
   cd database
   docker-compose up -d
   ```

2. Access PostgreSQL:
   ```
   psql -h localhost -U postgres -d stockdata
   ```

3. Access Elasticsearch:
   ```
   curl http://localhost:9200
   ```

4. Access Kibana:
   ```
   http://localhost:5601
   ```

## Configuration
The database services are configured with:
- PostgreSQL running on port 5432
- Elasticsearch running on ports 9200 and 9300
- Kibana running on port 5601
- Persistent volumes for data storage
- Automatic schema initialization via init.sql

## User Roles
Three user roles are created for security:
- `reader`: Read-only access to all tables
- `writer`: Read and write access to all tables
- `admin`: Full administrative access

## Data Flow
1. Raw stock data is written to `stock_prices` table
2. Stream processing results are stored in `stock_metrics` table
3. Batch processing results are stored in aggregation tables
4. Trading signals are recorded in `trading_signals` table
5. Selected data can be indexed in Elasticsearch for analytics

## Scaling
- PostgreSQL can be scaled with replication for high availability
- TimescaleDB provides efficient partitioning for large time-series datasets
- Elasticsearch can be scaled with additional nodes in a cluster
